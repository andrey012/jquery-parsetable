/*
 *  jquery-parsetable - v0.0.10
 *  A jQuery plugin for capturing and parsing table data by copy-paste from text and spreadsheet editors directly to the form on web page.
 *  https://github.com/andrey012/jquery-parsetable.git
 *
 *  Made by Andrey Grinenko
 *  Under MIT License
 */
!function(a,b){"use strict";function c(b,c){this.element=b,this.settings=a.extend({},e,c),this._defaults=e,this._name=d,this.init()}var d="parseTable",e={pasteHeader:"Paste your table here",pasteLabel:"Paste table here (Ctrl-V)",pasteError:"This contents does not look like a table",pasteOk:"Ok",pasteCancel:"Cancel",confirmHeaderSingle:"Confirm, that information is good",confirmHeaderMultiple:"Choose one of found tables",confirmLabelSingle:"Following information was found, check it and confirm:",confirmLabelMultiple:"Following information was found, choose correct one, check it and confirm:",confirmOk:"Use this information",confirmCancel:"Cancel",wait:"Wait...",success:function(){alert("override me")},cancel:function(){},postProcess:function(a){return a}};a.extend(c.prototype,{init:function(){var b=this;a(this.element).click(function(){return b.showPasteDialog(),!1})},showPasteDialog:function(c,d){var e=this,f=a('<div><div></div><span style="color: red;"></span><iframe style="width: 100%"></iframe><div style="text-align: center;"><input type="button" name="ok" value=""/><input type="button" name="cancel" value=""/></div></div>');f.dialog({title:e.settings.pasteHeader,modal:!0,minWidth:Math.max(600,Math.round(.7*a(b).width())),close:e.settings.cancel,open:function(){e.fixOverlayZindex(f)}});var g,h=f.find("iframe")[0];h.contentDocument?g=h.contentDocument:h.contentWindow?g=h.contentWindow.document:h.document&&(g=h.document),g.write('<body style="margin: 0; padding: 0;" CONTENTEDITABLE>'),g.body.innerHTML=null!=c?c:e.settings.pasteLabel,null!=d&&f.find("span").text(d),f.find('input[name="cancel"]').val(e.settings.pasteCancel).click(function(){f.dialog("close")}),f.find('input[name="ok"]').val(e.settings.pasteOk).click(function(){e.parseTable(g.body.innerHTML,f)});var i=g.body.innerHTML;g.body.focus(),g.execCommand("selectAll",!1,null);var j=!1;g.body.onkeydown=function(a){27!==a.keyCode||a.altKey||a.ctrlKey||a.shiftKey||f.is(":visible")&&(j=!0)},g.body.onkeyup=function(a){27!==a.keyCode||a.altKey||a.ctrlKey||a.shiftKey||!j?j=!1:(f.dialog("close"),j=!1),g.body.innerHTML!==i&&(i=g.body.innerHTML,e.parseTable(i,f))}},parseTable:function(c,d){var e=this;d.dialog("option","close",null),d.dialog("close");var f=a("<div><span></span></div>");f.dialog({title:e.settings.wait,modal:!0,minWidth:Math.max(600,Math.round(.7*a(b).width())),close:function(){e.showPasteDialog(c)},open:function(){e.fixOverlayZindex(f),setTimeout(function(){var b=e.copyClipboardToArray(c);if(b=e.settings.postProcess(b),!1===b)f.dialog("option","close",null),f.dialog("close"),e.showPasteDialog(c,e.settings.pasteError);else{var d,g,h,i,j,k,l,m=0;for(d in b)if(0!==b[d].length){m++;var n=a("<div/>").appendTo(f),o=a('<table class="table table-bordered"/>').appendTo(n);a('<div style="text-align: center;"><input type="button" name="ok" value=""/><input type="button" name="cancel" value=""/></div>').appendTo(n),n.find('input[name="ok"]').val(e.settings.confirmOk),n.find('input[name="cancel"]').val(e.settings.confirmCancel),n.find('input[name="ok"]').attr("data-tableindex",d);var p=a("<tbody/>").appendTo(o),q=0;for(g in b[d])q=Math.max(q,b[d][g].length);for(g in b[d]){var r=a("<tr/>").appendTo(p);for(l=b[d][g].length;q>l;l++)b[d][g].push("");for(h in b[d][g]){var s=a("<td/>").appendTo(r);k=b[d][g][h],"undefined"==typeof k&&(k=""),"string"!=typeof k&&(k=""+k),b[d][g][h]=k,j=k.split("\n");for(i in j)a("<p/>").appendTo(s).text(j[i])}}}f.find("span").text(1>=m?e.settings.confirmLabelSingle:e.settings.confirmLabelMultiple),f.find("span").after('<a href="#" style="opacity: 0">debug</a>'),f.find("a").click(function(){return f.find("span").after('<br/>Debug information:<br/>Base64 of HTML:<br/><input type="text" onclick="this.select()" name="debug_base64" style="width: 100%"/><br/>HTML:<br/><textarea onclick="this.select()" name="debug_html" style="width: 100%; height: 150px;"></textarea>'),f.find('input[name="debug_base64"]').val(btoa(c)),f.find('textarea[name="debug_html"]').val(c),!1}),f.dialog("option","title",1>=m?e.settings.confirmHeaderSingle:e.settings.confirmHeaderMultiple),f.find('input[name="ok"]').click(function(){f.dialog("option","close",null),f.dialog("close"),e.settings.success(b[this.getAttribute("data-tableindex")])}),f.find('input[name="cancel"]').click(function(){f.dialog("close")}),f.find('input[name="ok"]').each(function(a,b){return b.scrollIntoView(),!1})}},0)}})},copyClipboardToArray:function(a){var b,c,d,e,f,g,h=[],i=[],j=[],k=[];if(!/<table[^>]*>([\s\S]*)<\/table>/gim.test(a))return!1;for(h=a.split(/<\/table>/i),e=0;e<h.length;e++){if(b=[],h[e]=h[e].replace(/[\n\r]+/g,""),h[e]=h[e].replace(/^.*[<]table[^>]*[>]/gim,""),h[e]=h[e].replace(/[<]\/table[>].*$/gim,""),j=[],/<tr[^>]*>([\s\S]*)<\/tr>/gim.test(h[e]))for(j=h[e].split(/<\/tr>/i),f=0;f<j.length;f++){if(c=[],d=!1,i=[],j[f]=j[f].replace(/<tbody[^>]*>/gim,""),j[f]=j[f].replace(/<\/tbody>/gim,""),j[f]=j[f].replace(/<tr[^>]*>/gim,""),j[f]=j[f].replace(/<\/tr>/gim,""),/<td[^>]*>([\s\S]*)<\/td>/gim.test(j[f]))for(i=j[f].split(/<\/td>/i),g=0;g<i.length;g++)i[g]=i[g].replace(/<\?xml[^>]*[>]/gi,""),i[g]=i[g].replace(/<\/?st1[:][^>]+[>]/g,""),i[g]=i[g].replace(/<td[^>]*>\s*/gim,""),i[g]=i[g].replace(/\s+$/gim,""),i[g]=i[g].replace(/<\/td>/gim,""),i[g]=i[g].replace(/line<\?[^\/>]*\/>/gim,""),i[g]=i[g].replace(/<p[^>]*>/gim,"\n"),i[g]=i[g].replace(/<\/p>/gim,""),i[g]=i[g].replace(/<span[^>]*>/gim,""),i[g]=i[g].replace(/<\/span>/gim,""),i[g]=i[g].replace(/<o[^>]*>/gim,""),i[g]=i[g].replace(/<\/o[^>]*>/gim,""),i[g]=i[g].replace(/&nbsp[;]/g," "),i[g]=i[g].replace(/<br\/?>/g,"\n"),i[g]=i[g].replace(/[\r]/g,""),i[g]=i[g].replace(/^\n+/,""),i[g]=i[g].replace(/\n+$/,""),i[g]=i[g].replace(/\n[\n \t]*\n/g,"\n"),i[g]=i[g].replace(/\n\s+/g,"\n"),i[g]=i[g].replace(/[ \t]+/g," "),i[g]=i[g].replace(/^\s+/g,""),i[g]=i[g].replace(/<colgroup[ >](.*<\/colgroup>)?[ \r\n]*/g,""),i[g]=i[g].replace(/<col(([ ]?[>])|([ ][^>]+[>]))[ \r\n]*/g,""),i[g]=i[g].replace(/<font[^>]*>/g,""),i[g]=i[g].replace(/<\/font>/g,""),i[g]=i[g].replace(/<b>/g,""),i[g]=i[g].replace(/<\/b>/g,""),i[g]=i[g].replace(/<strong>/g,""),i[g]=i[g].replace(/<\/strong>/g,""),i[g]=i[g].replace(/&amp;/g,"&"),c.push(i[g]),i[g].length>0&&(d=g);if(d!==!1){for(;c.length>d+1;)c.pop();b.push(c)}}k.push(b)}return k},fixOverlayZindex:function(b){var c,d=100;a(this.element).parents().each(function(b,e){c=parseInt(a(e).css("z-index")),c>d&&(d=c)}),a(".ui-widget-overlay").css("z-index",d+1),b.parent().css("z-index",d+2)}}),a.fn[d]=function(b){return this.each(function(){a.data(this,"plugin_"+d)||a.data(this,"plugin_"+d,new c(this,b))})}}(jQuery,window,document);