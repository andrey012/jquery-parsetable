/*
 *  jquery-parsetable - v0.0.16
 *  A jQuery plugin for capturing and parsing table data by copy-paste from text and spreadsheet editors directly to the form on web page.
 *  https://github.com/andrey012/jquery-parsetable.git
 *
 *  Made by Andrey Grinenko
 *  Under MIT License
 */
!function(a,b,c){"use strict";function d(b,c){this.element=b,this.settings=a.extend({},f,c),this._defaults=f,this._name=e,this.init()}var e="parseTable",f={pasteHeader:"Paste your table here",pasteLabel:"Paste table here (Ctrl-V)",pasteHint:"You can paste mixed data with several tables, just do Ctrl-A Ctrl-C Ctrl-V from your document",pasteError:"This contents does not look like a table",pasteOk:"Ok",pasteCancel:"Cancel",confirmHeaderSingle:"Confirm, that information is good",confirmHeaderMultiple:"Choose one of found tables",confirmLabelSingle:"Following information was found, check it and confirm:",confirmLabelMultiple:"Following information was found, choose correct one, check it and confirm:",confirmOk:"Use this information",confirmCancel:"Cancel",wait:"Wait...",success:function(){alert("override me")},cancel:function(){},postProcess:function(a){return a},openOnPageLoad:!1};a.extend(d.prototype,{init:function(){var b=this;a(this.element).click(function(){return b.showPasteDialog(),!1}),b.settings.openOnPageLoad&&a(c).ready(function(){b.showPasteDialog()})},showPasteDialog:function(c,d){var e=this,f=a('<div><div></div><span style="color: red;"></span><div style="margin-bottom: -50px; height: 50px; width: 100%; text-align: center; font-size: 2em; opacity: 0.3;"></div><iframe style="width: 100%"></iframe><div style="text-align: center;"><span></span><br/><input type="button" name="ok" value=""/><input type="button" name="cancel" value=""/></div></div>');f.dialog({title:e.settings.pasteHeader,modal:!0,minWidth:Math.max(600,Math.round(.7*a(b).width())),close:e.settings.cancel,open:function(){e.fixOverlayZindex(f)}}),f.find("div ~ span ~ div:first").text(e.settings.pasteLabel),f.find("div:last > span").text(e.settings.pasteHint);var g,h=f.find("iframe")[0];h.contentDocument?g=h.contentDocument:h.contentWindow?g=h.contentWindow.document:h.document&&(g=h.document),g.write('<body style="margin: 0; padding: 0;" CONTENTEDITABLE>'),null!=c&&(g.body.innerHTML=c),null!=d&&f.find("span").text(d),f.find('input[name="cancel"]').val(e.settings.pasteCancel).click(function(){f.dialog("close")}),f.find('input[name="ok"]').val(e.settings.pasteOk).click(function(){e.parseTable(g.body.innerHTML,f)});var i=g.body.innerHTML;g.body.focus(),g.execCommand("selectAll",!1,null);var j=!1;g.body.onkeydown=function(a){27!==a.keyCode||a.altKey||a.ctrlKey||a.shiftKey||f.is(":visible")&&(j=!0)},g.body.onkeyup=function(a){27!==a.keyCode||a.altKey||a.ctrlKey||a.shiftKey||!j?j=!1:(f.dialog("close"),j=!1),g.body.innerHTML!==i&&(i=g.body.innerHTML,e.parseTable(i,f))}},parseTable:function(c,d){var e=this;d.dialog("option","close",null),d.dialog("close");var f=a("<div><span></span></div>");f.dialog({title:e.settings.wait,modal:!0,minWidth:Math.max(600,Math.round(.7*a(b).width())),close:function(){e.showPasteDialog(c)},open:function(){e.fixOverlayZindex(f),setTimeout(function(){var b=e.copyClipboardToArray(c),d=e.settings.postProcess(b),g=d;if(!1===g)f.dialog("option","close",null),f.dialog("close"),e.showPasteDialog(c,e.settings.pasteError);else{var h,i,j,k,l,m,n,o=0;for(h in g)if(0!==g[h].length){o++;var p=a("<div/>").appendTo(f),q=a('<table class="table table-bordered"/>').appendTo(p);a('<div style="text-align: center;"><input type="button" name="ok" value=""/><input type="button" name="cancel" value=""/></div>').appendTo(p),p.find('input[name="ok"]').val(e.settings.confirmOk),p.find('input[name="cancel"]').val(e.settings.confirmCancel),p.find('input[name="ok"]').attr("data-tableindex",h);var r=a("<tbody/>").appendTo(q),s=0;for(i in g[h])s=Math.max(s,g[h][i].length);for(i in g[h]){var t=a("<tr/>").appendTo(r);for(n=g[h][i].length;s>n;n++)g[h][i].push("");for(j in g[h][i]){var u=a("<td/>").appendTo(t);m=g[h][i][j],"undefined"==typeof m&&(m=""),"string"!=typeof m&&(m=""+m),g[h][i][j]=m,l=m.split("\n");for(k in l)a("<p/>").appendTo(u).text(l[k])}}}f.find("span").text(1>=o?e.settings.confirmLabelSingle:e.settings.confirmLabelMultiple),f.find("span").after('<a href="#" style="opacity: 0">debug</a>'),f.find("a").click(function(){return f.find("span").after('<br/>Debug information:<br/>Base64 of HTML:<br/><input type="text" onclick="this.select()" name="debug_base64" style="width: 100%" readonly="readonly"/><br/>HTML:<br/><textarea onclick="this.select()" name="debug_html" style="width: 100%; height: 150px;" readonly="readonly"></textarea><br/>Parsed JSON:<br/><textarea onclick="this.select()" name="debug_parsedjson" style="width: 100%; height: 150px;" readonly="readonly"></textarea><br/>Post processed JSON:<br/><textarea onclick="this.select()" name="debug_ppjson" style="width: 100%; height: 150px;" readonly="readonly"></textarea><br/>Cleaned (final) JSON:<br/><textarea onclick="this.select()" name="debug_cleanedjson" style="width: 100%; height: 150px;" readonly="readonly"></textarea>'),f.find('input[name="debug_base64"]').val(btoa(c)),f.find('textarea[name="debug_html"]').val(c),f.find('textarea[name="debug_parsedjson"]').val(JSON.stringify(b,null,"  ")),f.find('textarea[name="debug_ppjson"]').val(JSON.stringify(b,null,"  ")),f.find('textarea[name="debug_cleanedjson"]').val(JSON.stringify(b,null,"  ")),!1}),f.dialog("option","title",1>=o?e.settings.confirmHeaderSingle:e.settings.confirmHeaderMultiple),f.find('input[name="ok"]').click(function(){f.dialog("option","close",null),f.dialog("close"),e.settings.success(g[this.getAttribute("data-tableindex")])}),f.find('input[name="cancel"]').click(function(){f.dialog("close")}),f.find('input[name="ok"]').each(function(a,b){return b.scrollIntoView(),!1})}},0)}})},copyClipboardToArray:function(a){var b,c,d,e,f,g,h=[],i=[],j=[],k=[];if(!/<table[^>]*>([\s\S]*)<\/table>/gim.test(a))return!1;for(h=a.split(/<\/table>/i),e=0;e<h.length;e++){if(b=[],h[e]=h[e].replace(/[\n\r]+/g,""),h[e]=h[e].replace(/^.*[<]table[^>]*[>]/gim,""),h[e]=h[e].replace(/[<]\/table[>].*$/gim,""),j=[],/<tr[^>]*>([\s\S]*)<\/tr>/gim.test(h[e]))for(j=h[e].split(/<\/tr>/i),f=0;f<j.length;f++){if(c=[],d=!1,i=[],j[f]=j[f].replace(/<tbody[^>]*>/gim,""),j[f]=j[f].replace(/<\/tbody>/gim,""),j[f]=j[f].replace(/<tr[^>]*>/gim,""),j[f]=j[f].replace(/<\/tr>/gim,""),/<td[^>]*>([\s\S]*)<\/td>/gim.test(j[f]))for(i=j[f].split(/<\/td>/i),g=0;g<i.length;g++)i[g]=i[g].replace(/<\?xml[^>]*[>]/gi,""),i[g]=i[g].replace(/<\/?st1[:][^>]+[>]/g,""),i[g]=i[g].replace(/<td[^>]*>\s*/gim,""),i[g]=i[g].replace(/\s+$/gim,""),i[g]=i[g].replace(/<\/td>/gim,""),i[g]=i[g].replace(/line<\?[^\/>]*\/>/gim,""),i[g]=i[g].replace(/<p[^>]*>/gim,"\n"),i[g]=i[g].replace(/<\/p>/gim,""),i[g]=i[g].replace(/<span[^>]*>/gim,""),i[g]=i[g].replace(/<\/span>/gim,""),i[g]=i[g].replace(/<o[^>]*>/gim,""),i[g]=i[g].replace(/<\/o[^>]*>/gim,""),i[g]=i[g].replace(/&nbsp[;]/g," "),i[g]=i[g].replace(/<br\/?>/g,"\n"),i[g]=i[g].replace(/[\r]/g,""),i[g]=i[g].replace(/^\n+/,""),i[g]=i[g].replace(/\n+$/,""),i[g]=i[g].replace(/\n[\n \t]*\n/g,"\n"),i[g]=i[g].replace(/\n\s+/g,"\n"),i[g]=i[g].replace(/[ \t]+/g," "),i[g]=i[g].replace(/^\s+/g,""),i[g]=i[g].replace(/<colgroup[ >](.*<\/colgroup>)?[ \r\n]*/g,""),i[g]=i[g].replace(/<col(([ ]?[>])|([ ][^>]+[>]))[ \r\n]*/g,""),i[g]=i[g].replace(/<font[^>]*>/g,""),i[g]=i[g].replace(/<\/font>/g,""),i[g]=i[g].replace(/<b( [^>]+)?>/g,""),i[g]=i[g].replace(/<\/b>/g,""),i[g]=i[g].replace(/<strong>/g,""),i[g]=i[g].replace(/<\/strong>/g,""),i[g]=i[g].replace(/&amp;/g,"&"),i[g]=i[g].replace(/^\s+/g,""),i[g]=i[g].replace(/\s+$/g,""),c.push(i[g]),i[g].length>0&&(d=g);if(d!==!1){for(;c.length>d+1;)c.pop();b.push(c)}}b.length>0&&k.push(b)}return k},fixOverlayZindex:function(b){var c,d=100;a(this.element).parents().each(function(b,e){c=parseInt(a(e).css("z-index")),c>d&&(d=c)}),a(".ui-widget-overlay").css("z-index",d+1),b.parent().css("z-index",d+2)}}),a.fn[e]=function(b){return this.each(function(){a.data(this,"plugin_"+e)||a.data(this,"plugin_"+e,new d(this,b))})}}(jQuery,window,document);