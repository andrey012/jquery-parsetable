/*
 *  jquery-parsetable - v0.0.1
 *  A jQuery plugin for capturing and parsing table data by copy-paste from text and spreadsheet editors directly to the form on web page.
 *  https://github.com/andrey012/jquery-parsetable.git
 *
 *  Made by Andrey Grinenko
 *  Under MIT License
 */
!function(a,b){"use strict";function c(b,c){this.element=b,this.settings=a.extend({},e,c),this._defaults=e,this._name=d,this.init()}var d="parseTable",e={pasteHeader:"Paste your table here",pasteLabel:"Paste table here (Ctrl-V)",pasteError:"This contents does not look like a table",pasteOk:"Ok",pasteCancel:"Cancel",confirmHeader:"Confirm, that information is good",confirmLabel:"Following information was found:",confirmOk:"Use this information",confirmCancel:"Cancel",success:function(){alert("override me")},cancel:function(){}};a.extend(c.prototype,{init:function(){var b=this;a(this.element).click(function(){return b.showPasteDialog(),!1})},showPasteDialog:function(c,d){var e=this,f=a('<div><span style="color: red;"></span><iframe style="width: 100%"></iframe><div style="text-align: center;"><input type="button" name="ok" value="Ok"/><input type="button" name="cancel" value="Cancel"/></div></div>');f.dialog({modal:!0,minWidth:Math.max(600,Math.round(.7*a(b).width())),close:e.settings.cancel,open:function(){e.fixOverlayZindex(f)}});var g,h=f.find("iframe")[0];h.contentDocument?g=h.contentDocument:h.contentWindow?g=h.contentWindow.document:h.document&&(g=h.document),g.write('<body style="margin: 0; padding: 0;" CONTENTEDITABLE>Paste table here (Ctrl-V)</body>'),null!=c&&(g.body.innerHTML=c),null!=d&&f.find("span").text(d),f.find('input[name="cancel"]').click(function(){f.dialog("close")}),f.find('input[name="ok"]').click(function(){e.parseTable(g.body.innerHTML,f)});var i=g.body.innerHTML;g.body.focus(),g.execCommand("selectAll",!1,null);var j=!1;g.body.onkeydown=function(a){27!==a.keyCode||a.altKey||a.ctrlKey||a.shiftKey||(j=!0)},g.body.onkeyup=function(a){27!==a.keyCode||a.altKey||a.ctrlKey||a.shiftKey||!j?j=!1:f.dialog("close"),g.body.innerHTML!==i&&(i=g.body.innerHTML,e.parseTable(i,f))}},parseTable:function(c,d){var e=this;d.dialog("option","close",null),d.dialog("close");var f=a("<div></div>"),g=e.copyClipboardToArray(c);if(!1===g)this.showPasteDialog(c,"This contents does not look like a table");else{var h,i,j;for(h in g)if(0!==g[h].length){var k=a("<div/>").appendTo(f),l=a('<table class="table table-bordered"/>').appendTo(k);a('<div style="text-align: center;"><input type="button" name="ok" value="Ok"/><input type="button" name="cancel" value="Cancel"/></div>').appendTo(k),k.find('input[name="ok"]').attr("data-tableindex",h);var m=a("<tbody/>").appendTo(l);for(i in g[h]){var n=a("<tr/>").appendTo(m);for(j in g[h][i]){var o=a("<td/>").appendTo(n);o.text(g[h][i][j])}}}f.dialog({modal:!0,minWidth:Math.max(600,Math.round(.7*a(b).width())),close:function(){e.showPasteDialog(c)},open:function(){e.fixOverlayZindex(f)}}),f.find('input[name="ok"]').click(function(){f.dialog("option","close",null),f.dialog("close"),e.settings.success(g[this.getAttribute("data-tableindex")])}),f.find('input[name="cancel"]').click(function(){f.dialog("close")})}},copyClipboardToArray:function(a){var b,c,d,e,f,g,h=[],i=[],j=[],k=[];if(!/<table[^>]*>([\s\S]*)<\/table>/gim.test(a))return!1;for(h=a.split(/<\/table>/i),e=0;e<h.length;e++){if(b=[],h[e]=h[e].replace(/[\n\r]+/g,""),h[e]=h[e].replace(/^.*[<]table[^>]*[>]/gim,""),h[e]=h[e].replace(/[<]\/table[>].*$/gim,""),j=[],/<tr[^>]*>([\s\S]*)<\/tr>/gim.test(h[e]))for(j=h[e].split(/<\/tr>/i),f=0;f<j.length;f++){if(c=[],d=!1,i=[],j[f]=j[f].replace(/<tbody[^>]*>/gim,""),j[f]=j[f].replace(/<\/tbody>/gim,""),j[f]=j[f].replace(/<tr[^>]*>/gim,""),j[f]=j[f].replace(/<\/tr>/gim,""),/<td[^>]*>([\s\S]*)<\/td>/gim.test(j[f]))for(i=j[f].split(/<\/td>/i),g=0;g<i.length;g++)i[g]=i[g].replace(/<\?xml[^>]*[>]/gi,""),i[g]=i[g].replace(/<\/?st1[:][^>]+[>]/g,""),i[g]=i[g].replace(/<td[^>]*>\s*/gim,""),i[g]=i[g].replace(/\s+$/gim,""),i[g]=i[g].replace(/<\/td>/gim,""),i[g]=i[g].replace(/line<\?[^\/>]*\/>/gim,""),i[g]=i[g].replace(/<p[^>]*>/gim,"\n"),i[g]=i[g].replace(/<\/p>/gim,""),i[g]=i[g].replace(/<span[^>]*>/gim,""),i[g]=i[g].replace(/<\/span>/gim,""),i[g]=i[g].replace(/<o[^>]*>/gim,""),i[g]=i[g].replace(/<\/o[^>]*>/gim,""),i[g]=i[g].replace(/&nbsp[;]/g," "),i[g]=i[g].replace(/<br\/?>/g,"\n"),i[g]=i[g].replace(/[\r]/g,""),i[g]=i[g].replace(/^\n+/,""),i[g]=i[g].replace(/\n+$/,""),i[g]=i[g].replace(/\n[\n \t]*\n/g,"\n"),i[g]=i[g].replace(/\n\s+/g,"\n"),i[g]=i[g].replace(/[ \t]+/g," "),i[g]=i[g].replace(/^\s+/g,""),i[g]=i[g].replace(/<colgroup[ >].*<\/colgroup>[ \r\n]*/g,""),i[g]=i[g].replace(/<font[^>]*>/g,""),i[g]=i[g].replace(/<\/font>/g,""),i[g]=i[g].replace(/<b>/g,""),i[g]=i[g].replace(/<\/b>/g,""),i[g]=i[g].replace(/<strong>/g,""),i[g]=i[g].replace(/<\/strong>/g,""),i[g]=i[g].replace(/&amp;/g,"&"),c.push(i[g]),i[g].length>0&&(d=g);if(d){for(;c.length>d+1;)c.pop();b.push(c)}}k.push(b)}return k},fixOverlayZindex:function(b){var c,d=100;a(this.element).parents().each(function(b,e){c=parseInt(a(e).css("z-index")),c>d&&(d=c)}),a(".ui-widget-overlay").css("z-index",d+1),b.parent().css("z-index",d+2)}}),a.fn[d]=function(b){return this.each(function(){a.data(this,"plugin_"+d)||a.data(this,"plugin_"+d,new c(this,b))})}}(jQuery,window,document);